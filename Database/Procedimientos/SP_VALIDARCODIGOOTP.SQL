CREATE OR REPLACE PROCEDURE SP_VALIDARCODIGOTP(MAIL_IN VARCHAR2, RUN_IN NUMBER, CODIGO_OTP_IN VARCHAR2, RESULTADO_OUT OUT NUMBER)
IS 
	VALIDADOR_EXISTENCIA NUMBER;
BEGIN
	SELECT ID_GESTION INTO VALIDADOR_EXISTENCIA FROM GESTION_OTP WHERE LOWER(MAIL) = LOWER(MAIL_IN) AND RUN = RUN_IN AND ESTADO = 'A' AND USADO = 0 AND CODIGO_OTP = CODIGO_OTP_IN;
    IF VALIDADOR_EXISTENCIA>0 THEN
        RESULTADO_OUT:= 0;
    ELSE
        RESULTADO_OUT:= -1;
    END IF;
EXCEPTION
WHEN NO_DATA_FOUND THEN
    RESULTADO_OUT:= -1;

END;
