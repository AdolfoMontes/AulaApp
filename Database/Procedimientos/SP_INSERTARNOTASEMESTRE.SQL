CREATE OR REPLACE PROCEDURE SP_INSERTARNOTASEMESTRE(RUN_IN IN NUMBER, ID_ASIGNATURA_IN NUMBER, ANIO_IN IN NUMBER
            , N1_IN IN NUMBER, N2_IN IN NUMBER, N3_IN IN NUMBER, N4_IN IN NUMBER, N5_IN IN NUMBER, N6_IN IN NUMBER,
            N7_IN IN NUMBER, N8_IN IN NUMBER, N9_IN IN NUMBER, N10_IN IN NUMBER, SEMESTRE_IN IN NUMBER,  RESULTADO_OUT OUT VARCHAR)
IS 
    SQL_ERRORCODE INT;
    SQL_ERRORMESSAGE VARCHAR(1500);
    VALIDADOR_ASIGNATURA NUMBER;
BEGIN 
    VALIDADOR_ASIGNATURA:=F_VALIDARNOTASEMESTRE(RUN_IN, ANIO_IN, ID_ASIGNATURA_IN);
    IF VALIDADOR_ASIGNATURA = 0 AND SEMESTRE_IN = 1 THEN
        INSERT INTO NOTA(ID_NOTA, RUN, ID_ASIGNATURA, ANIO, N1, N2, N3, N4, N5, N6, N7, N8, N9, N10, ESTADO) VALUES
        ((SELECT NVL(MAX(ID_NOTA), 0) +1 FROM NOTA), RUN_IN, ID_ASIGNATURA_IN, ANIO_IN, N1_IN, N2_IN, N3_IN, N4_IN, N5_IN, N6_IN, N7_IN,
                        N8_IN, N9_IN, N10_IN, 'Z');
        SP_CALCULARNOTA1SEMESTRE(RUN_IN, ID_ASIGNATURA_IN);
        RESULTADO_OUT:= 0;
    ELSIF VALIDADOR_ASIGNATURA = 0 AND SEMESTRE_IN = 2 THEN
        INSERT INTO NOTA(ID_NOTA, RUN, ID_ASIGNATURA, ANIO, N11, N12, N13, N14, N15, N16, N17, N18, N19, N20, ESTADO) VALUES
        ((SELECT NVL(MAX(ID_NOTA), 0) +1 FROM NOTA), RUN_IN, ID_ASIGNATURA_IN, ANIO_IN, N1_IN, N2_IN, N3_IN, N4_IN, N5_IN, N6_IN, N7_IN,
                        N8_IN, N9_IN, N10_IN, 'Z');
        SP_CALCULARNOTA2SEMESTRE(RUN_IN, ID_ASIGNATURA_IN);
        RESULTADO_OUT:= 0;
    ELSIF VALIDADOR_ASIGNATURA > 0 AND SEMESTRE_IN = 1 THEN
        UPDATE NOTA SET N1 = N1_IN, N2 = N2_IN, N3 = N3_IN, N4 = N4_IN, N5 = N5_IN, N6 = N6_IN, N7 = N7_IN, N8 = N8_IN, N9 = N9_IN,
                        N10 = N10_IN WHERE ID_NOTA = VALIDADOR_ASIGNATURA;
        SP_CALCULARNOTA1SEMESTRE(RUN_IN, ID_ASIGNATURA_IN);
        RESULTADO_OUT:= 1;
    ELSIF VALIDADOR_ASIGNATURA > 0 AND SEMESTRE_IN = 2 THEN
        UPDATE NOTA SET N11 = N1_IN, N12 = N2_IN, N13 = N3_IN, N14 = N4_IN, N15 = N5_IN, N16 = N6_IN, N17 = N7_IN, N18 = N8_IN, N19 = N9_IN,
                        N20 = N10_IN WHERE ID_NOTA = VALIDADOR_ASIGNATURA;
        SP_CALCULARNOTA2SEMESTRE(RUN_IN, ID_ASIGNATURA_IN);
        RESULTADO_OUT:= 1;
    ELSE
        RESULTADO_OUT:=-1;
    END IF;
    COMMIT;
EXCEPTION WHEN OTHERS THEN
    SQL_ERRORMESSAGE:=SQLERRM;
    SQL_ERRORCODE:= SQLCODE;
    
    INSERT INTO ERROR(ID_ERROR, PROCESO, COD_ERROR, MENSAJE_ERROR, FECHA) VALUES
                    ((SELECT NVL(MAX(ID_ERROR), 0)+1 FROM ERROR), 'SP_INSERTARNOTASEMESTRE',SQL_ERRORCODE,SQL_ERRORMESSAGE, CURRENT_TIMESTAMP );
    COMMIT;
    RESULTADO_OUT := -1;
END;
